export const usersData = [
    {
        id: 1,
        name: "Timur",
        surname: "Timurov",
        username: "12",
        password: "12",
        tel: "055-898-5555",
        products: [
            {
                id: 1,
                category: "samsung",
                name: "Samsung Galaxy Book Pro 360",
                description: "High-end Samsung convertible laptop",
                price: 1500,
                new: "yes",
                img: "https://www.pcworld.com/wp-content/uploads/2023/04/samsung-galaxy-book-pro-360-100888623-orig.jpg?quality=50&strip=all",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 2,
                category: "apple",
                name: "MacBook Pro 16-inch",
                description: "Powerful Apple laptop with M1 Pro chip",
                price: 2400,
                new: "yes",
                img: "https://www.notebookcheck-ru.com/fileadmin/Notebooks/Apple/MacBook_Pro_16_2021_M1_Max_32C_64GB/Unbenannt_1.jpg",
                ram: 16,
                cpu: "Apple M1 Pro",
                rom: 1024,
                romType: "NVMe",
                operatingSystem: "macOS",
                videoCard: "Apple M1 Pro GPU"
            },
            {
                id: 3,
                category: "asus",
                name: "ASUS ROG Zephyrus G14",
                description: "Compact gaming laptop with high performance",
                price: 1600,
                new: "yes",
                img: "https://deltastoreimages.s3.eu-central-1.amazonaws.com/4a26baa9-d142-4d03-ab62-64111c31647d.webp",
                ram: 16,
                cpu: "AMD Ryzen 9",
                rom: 1024,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "NVIDIA GeForce RTX 3060"
            },
            {
                id: 4,
                category: "acer",
                name: "Acer Swift 3",
                description: "Lightweight and affordable ultrabook",
                price: 800,
                new: "yes",
                img: "https://m.media-amazon.com/images/I/81nN5u1MEuL.jpg",
                ram: 8,
                cpu: "Intel Core i5",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            }
        ],
    },
    {
        id: 2,
        name: "Elvin",
        surname: "Mustafayev",
        username: "user2",
        password: "123",
        tel: "070-999-5465",
        products: [
            {
                id: 5,
                category: "dell",
                name: "Dell XPS 13",
                description: "Compact and powerful ultrabook",
                price: 1300,
                new: "yes",
                img: "https://images-cdn.ubuy.co.in/635f8ad9afed8b54834faff3-dell-xps-13-plus-9320-13-4.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 6,
                category: "hp",
                name: "HP Spectre x360",
                description: "Premium 2-in-1 laptop from HP",
                price: 1400,
                new: "yes",
                img: "https://ssl-product-images.www8-hp.com/digmedialib/prodimg/lowres/c08277669.png",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 7,
                category: "lenovo",
                name: "Lenovo IdeaPad Flex 5",
                description: "Versatile 2-in-1 laptop with solid performance",
                price: 700,
                new: "yes",
                img: "https://amazoncomp.az/wp-content/uploads/2021/02/a4e8c0f687840bafdcc0e58554e3edca.jpg",
                ram: 8,
                cpu: "AMD Ryzen 5",
                rom: 256,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "AMD Radeon Graphics"
            }
        ],
    },
    {
        id: 3,
        name: "Naila",
        surname: "Aliyeva",
        username: "user3",
        password: "123",
        tel: "055-989-7788",
        products: [
            {
                id: 8,
                category: "lenovo",
                name: "Lenovo ThinkPad X1 Carbon",
                description: "Business laptop with robust build quality",
                price: 1600,
                new: "yes",
                img: "https://m.media-amazon.com/images/I/61XXyxsfdRL._AC_SL1500_.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 9,
                category: "microsoft",
                name: "Microsoft Surface Laptop 4",
                description: "Sleek and stylish laptop with great performance",
                price: 1500,
                new: "yes",
                img: "https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE4LiXm?ver=45be&q=90&m=6&h=705&w=1253&b=%23FFFFFFFF&f=jpg&o=f&p=140&aim=true",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            }
        ],
    },
    {
        id: 4,
        name: "Alsu",
        surname: "Babekova",
        username: "user33",
        password: "123",
        tel: "055-989-7788",
        products: [
            {
                id: 1,
                category: "apple",
                name: "MacBook Pro 16",
                description: "High performance laptop with a stunning display",
                price: 2400,
                new: "yes",
                img: "https://amazoncomp.az/wp-content/uploads/2020/07/Apple-16-MacBook-Pro-Late-2019-Space-Gray2.jpg",
                ram: 16,
                cpu: "Apple M1 Pro",
                rom: 512,
                romType: "SSD",
                operatingSystem: "macOS",
                videoCard: "Integrated"
            },
            {
                id: 2,
                category: "dell",
                name: "Dell XPS 13",
                description: "Compact and powerful ultrabook",
                price: 1300,
                new: "no",
                img: "https://images-cdn.ubuy.co.in/635f8ad9afed8b54834faff3-dell-xps-13-plus-9320-13-4.jpg",
                ram: 8,
                cpu: "Intel Core i5",
                rom: 256,
                romType: "SSD",
                operatingSystem: "Windows 10",
                videoCard: "Intel UHD Graphics"
            },
            {
                id: 3,
                category: "hp",
                name: "HP Spectre x360",
                description: "Versatile 2-in-1 laptop with a beautiful design",
                price: 1600,
                new: "yes",
                img: "https://irshad.az/cdn-cgi/image/width=371/storage/products/87870/7n7m9ea-2.png",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "SSD",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 4,
                category: "asus",
                name: "ASUS ROG Zephyrus G14",
                description: "Gaming laptop with excellent performance",
                price: 1800,
                new: "no",
                img: "https://m.media-amazon.com/images/I/71o6nKXmjTL._AC_SL1500_.jpg",
                ram: 16,
                cpu: "AMD Ryzen 9",
                rom: 1,
                romType: "SSD",
                operatingSystem: "Windows 10",
                videoCard: "NVIDIA GeForce RTX 3060"
            },
            {
                id: 5,
                category: "lenovo",
                name: "Lenovo ThinkPad X1 Carbon",
                description: "Professional laptop with robust build quality",
                price: 1700,
                new: "yes",
                img: "https://m.media-amazon.com/images/I/61nm3dwXAmL._AC_UF894,1000_QL80_.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 10",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 6,
                category: "acer",
                name: "Acer Swift 3",
                description: "Affordable ultrabook with good performance",
                price: 700,
                new: "no",
                img: "https://m.media-amazon.com/images/I/81nN5u1MEuL.jpg",
                ram: 8,
                cpu: "Intel Core i5",
                rom: 256,
                romType: "SSD",
                operatingSystem: "Windows 10",
                videoCard: "Intel UHD Graphics"
            },
            {
                id: 7,
                category: "msi",
                name: "MSI Prestige 14",
                description: "Stylish laptop with excellent performance",
                price: 1400,
                new: "yes",
                img: "https://m.media-amazon.com/images/I/71LaIGItr+L._AC_UF894,1000_QL80_.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 10",
                videoCard: "NVIDIA GeForce GTX 1650"
            },
            {
                id: 8,
                category: "huawei",
                name: "Huawei MateBook X Pro",
                description: "Sleek ultrabook with a vibrant display",
                price: 1500,
                new: "yes",
                img: "https://www.notebookcheck.net/uploads/tx_nbc2/MateBook_X_Pro_2023_8.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 10",
                videoCard: "Intel Iris Xe"
            },
            {
                id: 9,
                category: "microsoft",
                name: "Microsoft Surface Laptop 4",
                description: "Sleek and stylish laptop with great performance",
                price: 1500,
                new: "yes",
                img: "https://m.media-amazon.com/images/I/71bntOtJ1QL.jpg",
                ram: 16,
                cpu: "Intel Core i7",
                rom: 512,
                romType: "NVMe",
                operatingSystem: "Windows 11",
                videoCard: "Intel Iris Xe"
            }
        ]

    }
];



export function initData() {
    let users = JSON.parse(localStorage.getItem("users"));
    if (!users) {
        localStorage.clear();
        localStorage.setItem("userId", null);
        localStorage.setItem("users", JSON.stringify(usersData))
    }
}

export function registrateUser(newUser) {
    const newUserWithId = {
        id: Math.random(),
        ...newUser
    }
    const users = JSON.parse(localStorage.getItem("users") || []);
    const newUsers = [...users, newUserWithId];
    localStorage.setItem("users", JSON.stringify(newUsers));
}

export function logInUser(formData) {
    // Получаем список пользователей из localStorage
    const users = JSON.parse(localStorage.getItem("users")) || [];

    // Находим пользователя по имени и паролю
    const user = users.find(item =>
        item.username === formData.username && item.password === formData.password
    );
    if (user) {
        // Сохраняем ID пользователя в localStorage
        localStorage.setItem('userId', user.id);
        // Возвращаем найденного пользователя
        return user;
    } else {
        // Возвращаем false, если пользователь не найден
        return false;
    }
}



export function logOut() {
    localStorage.setItem("userId", null)

}

export function getAllProducts() {
    // Извлекаем пользователей из localStorage или используем пустой массив, если пользователей нет
    const users = JSON.parse(localStorage.getItem('users')) || [];

    // Объединяем все продукты от всех пользователей в один массив
    const allProducts = users.reduce((acc, user) => {
        // Проверяем, есть ли у пользователя продукты
        if (user.products && Array.isArray(user.products)) {
            return [...acc, ...user.products];
        }
        return acc;
    }, []);

    return allProducts;
}
export function getAllCategories() {
    const allProducts = getAllProducts();

    if (!Array.isArray(allProducts)) {
        console.error('getAllProducts() должен возвращать массив продуктов');
        return [];
    }
    let allCategories = allProducts.map(product => product.category.toLowerCase());

    // Удаляем дублирующиеся элементы с помощью Set
    allCategories = [...new Set(allCategories)];
    console.log(allCategories);
    return allCategories;
}


export function getUserData() {
    // Получаем userId из localStorage и преобразуем в число
    const userId = JSON.parse(localStorage.getItem("userId"));
    // Получаем список пользователей из localStorage
    const users = JSON.parse(localStorage.getItem("users"));

    // Проверка наличия userId
    if (!userId) {
        console.error('userId не найден в localStorage');
        return null;
    }

    // Проверка наличия users
    if (!users) {
        console.error('users не найдены в localStorage');
        return null;
    }

    // Проверка, является ли users массивом
    if (!Array.isArray(users)) {
        console.error('Неправильный формат данных users в localStorage');
        return null;
    }

    // Поиск пользователя по userId
    const user = users.find(user => user.id === userId);

    // Проверка наличия пользователя
    if (!user) {
        console.warn(`Пользователь с id: ${userId} не найден`);
        return null;
    }

    console.log('Найден пользователь:', user);

    // Возвращаем найденного пользователя
    return user;
}




export function deleteProductFromDatabase(userId, productId) {
    // Получаем список пользователей из localStorage
    let users = JSON.parse(localStorage.getItem("users")) || [];

    // Находим пользователя по userId
    const userIndex = users.findIndex(user => user.id === userId);

    if (userIndex !== -1) {
        // Находим индекс продукта у найденного пользователя
        const productIndex = users[userIndex].products.findIndex(product => product.id === productId);

        if (productIndex !== -1) {
            // Удаляем продукт из массива у найденного пользователя
            users[userIndex].products.splice(productIndex, 1);

            // Обновляем localStorage с обновленным массивом пользователей
            localStorage.setItem('users', JSON.stringify(users));

            // Возвращаем обновленного пользователя (необязательно, зависит от требований)
            return users[userIndex];
        } else {
            console.error(`Продукт с id ${productId} не найден у пользователя с id ${userId}`);
            return null; // Возвращаем null, если продукт не найден у пользователя
        }
    } else {
        console.error(`Пользователь с id ${userId} не найден в localStorage`);
        return null; // Возвращаем null, если пользователь не найден
    }
}

export function addNewProductToDatabase(user, newProduct) {
    // Получаем список пользователей из localStorage
    let users = JSON.parse(localStorage.getItem("users")) || [];

    // Находим индекс пользователя по его id
    const userIndex = users.findIndex(item => item.id === user.id);

    if (userIndex !== -1) {
        // Обновляем список продуктов пользователя
        users[userIndex].products = [...users[userIndex].products, newProduct];
        // Обновляем localStorage с обновленным массивом пользователей
        localStorage.setItem('users', JSON.stringify(users));
        // Возвращаем обновленного пользователя
        return users[userIndex];
    } else {
        console.error(`Пользователь с id ${user.id} не найден в localStorage`);
        return null; // Возвращаем null, если пользователь не найден
    }
}


export function editProductFromDatabase(user, updatedProducts) {
    // Создаем обновленного пользователя с обновленным списком продуктов
    const updatedUser = { ...user, products: [...updatedProducts] };
    // Получаем список пользователей из localStorage
    let users = JSON.parse(localStorage.getItem("users")) || [];

    // Находим индекс пользователя по его id
    const userIndex = users.findIndex(item => item.id === user.id);

    if (userIndex !== -1) {
        // Обновляем пользователя в массиве пользователей
        users[userIndex] = updatedUser;
        // Обновляем localStorage с обновленным массивом пользователей
        localStorage.setItem('users', JSON.stringify(users));
        // Возвращаем обновленного пользователя
        return users[userIndex];
    } else {
        console.error(`Пользователь с id ${user.id} не найден в localStorage`);
        return null; // Возвращаем null, если пользователь не найден
    }
}